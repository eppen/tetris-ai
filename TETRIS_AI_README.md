# 俄罗斯方块游戏 - AI玩家版本

## 🎮 游戏简介
这是一个带有AI玩家功能的俄罗斯方块游戏。你可以手动玩游戏，也可以让AI自动玩！

## 🚀 如何运行

### 1. 启动游戏
```bash
cd /Users/liuhualiang/.nanobot/workspace/tetris
python tetris.py
```

### 2. 游戏控制

#### 基本控制
- **← →** : 左右移动方块
- **↑** : 旋转方块
- **↓** : 加速下落
- **空格** : 硬降落（直接落到底部）
- **R** : 重新开始游戏
- **ESC** : 退出游戏

#### AI控制
- **A** : 切换AI模式（启用/禁用）

## 🤖 AI玩家功能

### AI算法特点
1. **位置评估** - AI会评估每个可能位置的优劣
2. **决策系统** - 选择最佳放置位置
3. **路径规划** - 自动计算移动和旋转步骤
4. **实时控制** - 自动执行移动计划

### AI评估标准
AI根据以下因素评估位置：
- **高度惩罚** - 鼓励放在底部
- **空洞惩罚** - 避免创建空洞
- **行完整度奖励** - 鼓励完成整行
- **凹凸不平惩罚** - 保持棋盘表面平整

### AI状态显示
- 侧边栏会显示AI状态（启用/禁用）
- AI启用时显示绿色"AI: 启用"
- AI禁用时显示红色"AI: 禁用"

## 📊 游戏特性

### 计分系统
- 消除1行: 100分 × 等级
- 消除2行: 300分 × 等级
- 消除3行: 500分 × 等级
- 消除4行（Tetris!）: 800分 × 等级

### 等级系统
- 每消除10行升一级
- 等级越高，方块下落速度越快
- 最高速度限制为0.05秒/格

## 🧪 测试AI功能
运行测试脚本验证AI功能：
```bash
python test_ai.py
```

## 🛠️ 技术实现

### 主要类
1. **Tetromino** - 俄罗斯方块单个方块
2. **TetrisGame** - 游戏主类
3. **TetrisAI** - AI玩家类

### AI算法流程
1. 遍历所有可能的旋转状态（0-3次）
2. 遍历所有可能的水平位置
3. 计算每个位置能下落到的最大高度
4. 评估每个位置的得分
5. 选择得分最低（最优）的位置
6. 生成移动计划并执行

### 碰撞检测
- 支持带旋转参数的碰撞检测
- 支持临时状态模拟
- 确保AI决策不会导致游戏崩溃

## 📈 性能优化
- AI决策间隔可调节（默认0.3秒）
- 使用临时状态模拟避免影响游戏
- 优化评估函数计算效率

## 🎯 使用建议

### 手动模式
- 适合练习俄罗斯方块技巧
- 完全控制游戏节奏

### AI模式
- 观察AI如何决策
- 学习AI的放置策略
- 测试AI在不同情况下的表现

### 混合模式
- 可以在游戏过程中随时切换
- AI模式遇到困难时可切换手动
- 手动模式累了可让AI接管

## 🔧 自定义AI
如果你想调整AI行为，可以修改以下参数：

1. **AI速度** (`ai_speed` in `TetrisAI.__init__`)
   - 降低值让AI决策更快
   - 提高值让AI决策更慢（便于观察）

2. **评估权重** (`evaluate_position` 方法)
   - 调整高度、空洞、行完整度、凹凸度的权重
   - 根据个人偏好优化AI策略

## 🐛 已知问题
- AI在某些极端情况下可能做出非最优决策
- 评估函数可能需要进一步调优
- 游戏窗口标题切换时可能有轻微延迟

## 📝 更新日志
- **v1.0** - 初始版本，添加基础AI功能
- **v1.1** - 优化评估函数，添加测试脚本
- **v1.2** - AI 启用时考虑下一个方块（look-ahead），决策更优；侧栏「下一个」在 AI 模式下显示「下一个 (AI会参考)」

## 🎉 享受游戏！
现在你可以享受观看AI玩俄罗斯方块的乐趣了！按'A'键开始吧！